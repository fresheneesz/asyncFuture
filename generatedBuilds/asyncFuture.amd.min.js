/* Copyright (c) 2013 Billy Tetrud - Free to use for any purpose: MIT License*/
require(["jQuery"],function(){function r(t){if(arguments.length>0){var e=new r;return e.return(t),e}this.resolved=!1,this.queue=[],r.debug&&(h++,this.id=h)}function t(t,e){if(!(e instanceof r)&&void 0!==e)throw Error("Value returned from then or catch *not* a Future: "+e);o(t,"next",e)}function e(r,t){r.resolved?i(r,[t]):r.queue.push(t)}function n(r,o,i){e(o,function(){if(this.hasError)r.throw(this.error);else if(this.hasNext)n(r,this.next,i);else try{t(r,i(this.result))}catch(e){r.throw(e)}})}function o(r,t,e){if(r.resolved)throw Error("Future resolved more than once! Resolution: "+e);r.resolved=!0,r.hasError="error"===t,r.hasNext="next"===t&&void 0!==e,r.hasError?r.error=e:r.hasNext?r.next=e:r.result=e,i(r,r.queue)}function i(r,t){t.length>0&&setTimeout(function(){t.forEach(function(t){t.apply(r)})},0)}var s={exports:{}};s.exports;var u=require("trimArguments");s.exports=r,r.debug=!1;var h=0;r.all=function(){if(arguments[0]instanceof Array)var t=arguments[0];else var t=u(arguments);var e=new r,n=[];if(t.length>0){var o=t[0];t.forEach(function(r,e){o=o.then(function(r){return n[e]=r,t[e+1]})}),o.catch(function(r){e.throw(r)}),o.then(function(){e.return(n)})}else e.return(n);return e},r.wrap=function(){if(1===arguments.length)var t=arguments[0],e=void 0;else var e=arguments[0],t=e[arguments[1]];return function(){var n=Array.prototype.slice.call(arguments),o=new r;n.push(o.resolver());var i=this;return e&&(i=e),t.apply(i,n),o}};var a=function(r){setTimeout(function(){throw r},0)};return r.error=function(r){a=r},r.prototype.return=function(r){o(this,"return",r)},r.prototype.throw=function(r){o(this,"error",r)},r.prototype.then=function(o){var i=new r;return e(this,function(){if(this.hasError)i.throw(this.error);else if(this.hasNext)n(i,this.next,o);else try{t(i,o(this.result))}catch(r){i.throw(r)}}),i},r.prototype.catch=function(n){var o=new r;return e(this,function(){if(this.hasError)try{t(o,n(this.error))}catch(r){o.throw(r)}else this.hasNext?t(o,this.next):o.return(this.result)}),o},r.prototype.finally=function(t){var n=new r;return e(this,function(){try{t(),this.hasError?n.throw(this.error):n.return(this.result)}catch(r){n.throw(r)}}),n},r.prototype.done=function(){e(this,function(){this.hasError&&a(this.error)})},r.prototype.resolver=function(){var r=this;return function(t,e){t?r.throw(t):r.return(e)}},r.prototype.isResolved=function(){return this.resolved},s.exports});